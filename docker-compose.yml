version: "3.8"

services:
  3xui-shop:
    container_name: 3xui-shop
    # Если хочешь собирать из исходников репо:
    build: .
    # Если хочешь использовать готовый образ (если автор его пушил) —
    # можешь заменить build на image, например:
    # image: ghcr.io/snoups/3xui-shop:latest
    restart: unless-stopped

    # Dokploy сам создаст network и подключит Traefik, 
    # поэтому НИКАКОГО traefik-сервиса тут не пишем.
    env_file:
      - .env

    # То, что тебе нужно будет хранить снаружи контейнера:
    volumes:
      # планы подписок
      - ./plans.json:/app/plans.json:ro
      # логи и база (если проект хранит их в ./data и ./logs — типичный вариант)
      - ./data:/app/data
      - ./logs:/app/logs

    # Открываем только порт приложения.
    # В .env по умолчанию BOT_PORT=8080, под него и маппим.
    ports:
      - "8080:8080"

    # На всякий случай — простая healthcheck
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8080/ || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 5
      start_period: 20s
